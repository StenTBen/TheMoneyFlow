<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vår Ekonomi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-tab.active {
            background: #3498db;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #ecf0f1;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.2em;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #34495e;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .summary-item h4 {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-item .amount {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
        }

        .summary-item.positive .amount {
            color: #27ae60;
        }

        .summary-item.negative .amount {
            color: #e74c3c;
        }

        .expense-item, .bill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .expense-item:last-child, .bill-item:last-child {
            border-bottom: none;
        }

        .expense-details, .bill-details {
            flex: 1;
        }

        .expense-name, .bill-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .expense-meta, .bill-meta {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .expense-amount, .bill-amount {
            font-weight: bold;
            color: #2c3e50;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .month-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .month-nav {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .month-nav:hover {
            background: #2980b9;
        }

        .current-month {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            min-width: 150px;
            text-align: center;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                margin: 2px 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Vår Ekonomi</h1>
        <p>Gemensam ekonomi för par</p>
    </div>

    <div class="nav-tabs">
        <div class="nav-tab active" onclick="showTab('dashboard')">Översikt</div>
        <div class="nav-tab" onclick="showTab('income')">Inkomster</div>
        <div class="nav-tab" onclick="showTab('bills')">Räkningar</div>
        <div class="nav-tab" onclick="showTab('savings')">Sparande & Rörligt</div>
        <div class="nav-tab" onclick="showTab('monthly')">Månadsvy</div>
    </div>

    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content active">
        <div class="summary-grid">
            <div class="summary-item">
                <h4>Total Nettoinkomst</h4>
                <div class="amount" id="totalIncome">0 kr</div>
            </div>
            <div class="summary-item">
                <h4>Totala Räkningar</h4>
                <div class="amount" id="totalBills">0 kr</div>
            </div>
            <div class="summary-item">
                <h4>Totalt Sparande & Rörligt</h4>
                <div class="amount" id="totalSavings">0 kr</div>
            </div>
            <div class="summary-item positive">
                <h4>Kvar Efter Allt</h4>
                <div class="amount" id="remaining">0 kr</div>
            </div>
        </div>

        <div class="card">
            <h3>Fördelning Denna Månad</h3>
            <div class="summary-grid">
                <div class="summary-item">
                    <h4 id="person1Name">Person 1</h4>
                    <div class="amount" id="person1Share">0 kr</div>
                    <small>Skuld/Tillgodo</small>
                </div>
                <div class="summary-item">
                    <h4 id="person2Name">Person 2</h4>
                    <div class="amount" id="person2Share">0 kr</div>
                    <small>Skuld/Tillgodo</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Income Tab -->
    <div id="income" class="tab-content">
        <div class="card">
            <h3>Månadsinkomster</h3>
            
            <div class="input-group">
                <label for="person1NameInput">Person 1 Namn:</label>
                <input type="text" id="person1NameInput" placeholder="Namn" value="Du">
            </div>
            
            <div class="input-group">
                <label for="person1Income">Person 1 Nettolön:</label>
                <input type="number" id="person1Income" placeholder="Nettolön i kr">
            </div>
            
            <div class="input-group">
                <label for="person2NameInput">Person 2 Namn:</label>
                <input type="text" id="person2NameInput" placeholder="Namn" value="Partner">
            </div>
            
            <div class="input-group">
                <label for="person2Income">Person 2 Nettolön:</label>
                <input type="number" id="person2Income" placeholder="Nettolön i kr">
            </div>
            
            <button class="btn" onclick="saveIncomes()">Spara Inkomster</button>
        </div>
    </div>

    <!-- Bills Tab -->
    <div id="bills" class="tab-content">
        <div class="card">
            <h3>Lägg Till Räkning</h3>
            
            <div class="input-group">
                <label for="billName">Räkningsnamn:</label>
                <input type="text" id="billName" placeholder="t.ex. Hyra, El, Internet">
            </div>
            
            <div class="input-group">
                <label for="billAmount">Belopp:</label>
                <input type="number" id="billAmount" placeholder="Belopp i kr">
            </div>
            
            <div class="input-group">
                <label for="billPaidBy">Vem betalade:</label>
                <select id="billPaidBy">
                    <option value="person1">Person 1</option>
                    <option value="person2">Person 2</option>
                </select>
            </div>
            
            <button class="btn" onclick="addBill()">Lägg Till Räkning</button>
        </div>

        <div class="card">
            <h3>Räkningar Denna Månad</h3>
            <div id="billsList"></div>
        </div>
    </div>

    <!-- Savings Tab -->
    <div id="savings" class="tab-content">
        <div class="card">
            <h3>Lägg Till Sparande/Rörlig Utgift</h3>
            
            <div class="input-group">
                <label for="savingName">Namn:</label>
                <input type="text" id="savingName" placeholder="t.ex. Mat, Bensin, Sparande">
            </div>
            
            <div class="input-group">
                <label for="savingAmount">Belopp:</label>
                <input type="number" id="savingAmount" placeholder="Belopp i kr">
            </div>
            
            <div class="input-group">
                <label for="savingType">Fördelning:</label>
                <select id="savingType" onchange="toggleSavingOptions()">
                    <option value="equal">Jämn fördelning (50/50)</option>
                    <option value="percentage">Enligt löneandel (%)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="savingPaidBy">Vem betalade:</label>
                <select id="savingPaidBy">
                    <option value="person1">Person 1</option>
                    <option value="person2">Person 2</option>
                </select>
            </div>
            
            <button class="btn" onclick="addSaving()">Lägg Till</button>
        </div>

        <div class="card">
            <h3>Sparande & Rörliga Utgifter</h3>
            <div id="savingsList"></div>
        </div>
    </div>

    <!-- Monthly Tab -->
    <div id="monthly" class="tab-content">
        <div class="month-selector">
            <button class="month-nav" onclick="changeMonth(-1)">←</button>
            <div class="current-month" id="currentMonth"></div>
            <button class="month-nav" onclick="changeMonth(1)">→</button>
        </div>

        <div class="summary-grid">
            <div class="summary-item">
                <h4>Månadens Inkomst</h4>
                <div class="amount" id="monthlyIncome">0 kr</div>
            </div>
            <div class="summary-item">
                <h4>Månadens Utgifter</h4>
                <div class="amount" id="monthlyExpenses">0 kr</div>
            </div>
            <div class="summary-item">
                <h4>Månadens Resultat</h4>
                <div class="amount" id="monthlyResult">0 kr</div>
            </div>
        </div>

        <div class="card">
            <h3>Månadsdetaljer</h3>
            <div id="monthlyDetails"></div>
        </div>
    </div>

    <script>
        // Global data storage
        let appData = {
            person1: { name: 'Du', income: 0 },
            person2: { name: 'Partner', income: 0 },
            bills: [],
            savings: [],
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear()
        };

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('coupleFinanceData');
            if (saved) {
                appData = { ...appData, ...JSON.parse(saved) };
            }
            updateUI();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('coupleFinanceData', JSON.stringify(appData));
        }

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'monthly') {
                updateMonthlyView();
            }
        }

        // Save incomes
        function saveIncomes() {
            appData.person1.name = document.getElementById('person1NameInput').value || 'Person 1';
            appData.person1.income = parseFloat(document.getElementById('person1Income').value) || 0;
            appData.person2.name = document.getElementById('person2NameInput').value || 'Person 2';
            appData.person2.income = parseFloat(document.getElementById('person2Income').value) || 0;
            
            saveData();
            updateUI();
            alert('Inkomster sparade!');
        }

        // Add bill
        function addBill() {
            const name = document.getElementById('billName').value;
            const amount = parseFloat(document.getElementById('billAmount').value);
            const paidBy = document.getElementById('billPaidBy').value;
            
            if (!name || !amount) {
                alert('Fyll i alla fält');
                return;
            }
            
            const bill = {
                id: Date.now(),
                name,
                amount,
                paidBy,
                month: appData.currentMonth,
                year: appData.currentYear,
                date: new Date().toLocaleDateString('sv-SE')
            };
            
            appData.bills.push(bill);
            
            // Clear form
            document.getElementById('billName').value = '';
            document.getElementById('billAmount').value = '';
            
            saveData();
            updateUI();
        }

        // Add saving
        function addSaving() {
            const name = document.getElementById('savingName').value;
            const amount = parseFloat(document.getElementById('savingAmount').value);
            const type = document.getElementById('savingType').value;
            const paidBy = document.getElementById('savingPaidBy').value;
            
            if (!name || !amount) {
                alert('Fyll i alla fält');
                return;
            }
            
            const saving = {
                id: Date.now(),
                name,
                amount,
                type,
                paidBy,
                month: appData.currentMonth,
                year: appData.currentYear,
                date: new Date().toLocaleDateString('sv-SE')
            };
            
            appData.savings.push(saving);
            
            // Clear form
            document.getElementById('savingName').value = '';
            document.getElementById('savingAmount').value = '';
            
            saveData();
            updateUI();
        }

        // Delete item
        function deleteItem(type, id) {
            if (confirm('Är du säker på att du vill ta bort detta?')) {
                if (type === 'bill') {
                    appData.bills = appData.bills.filter(bill => bill.id !== id);
                } else if (type === 'saving') {
                    appData.savings = appData.savings.filter(saving => saving.id !== id);
                }
                saveData();
                updateUI();
            }
        }

        // Calculate totals and shares
        function calculateFinances() {
            const totalIncome = appData.person1.income + appData.person2.income;
            const person1Percentage = totalIncome > 0 ? appData.person1.income / totalIncome : 0.5;
            const person2Percentage = totalIncome > 0 ? appData.person2.income / totalIncome : 0.5;
            
            // Current month bills and savings
            const currentBills = appData.bills.filter(bill => 
                bill.month === appData.currentMonth && bill.year === appData.currentYear
            );
            const currentSavings = appData.savings.filter(saving => 
                saving.month === appData.currentMonth && saving.year === appData.currentYear
            );
            
            const totalBills = currentBills.reduce((sum, bill) => sum + bill.amount, 0);
            const totalSavings = currentSavings.reduce((sum, saving) => sum + saving.amount, 0);
            
            // Calculate what each person should pay
            let person1ShouldPay = 0;
            let person2ShouldPay = 0;
            
            // Bills are always split by income percentage
            person1ShouldPay += totalBills * person1Percentage;
            person2ShouldPay += totalBills * person2Percentage;
            
            // Savings depend on type
            currentSavings.forEach(saving => {
                if (saving.type === 'equal') {
                    person1ShouldPay += saving.amount / 2;
                    person2ShouldPay += saving.amount / 2;
                } else {
                    person1ShouldPay += saving.amount * person1Percentage;
                    person2ShouldPay += saving.amount * person2Percentage;
                }
            });
            
            // Calculate what each person has paid
            let person1Paid = 0;
            let person2Paid = 0;
            
            currentBills.forEach(bill => {
                if (bill.paidBy === 'person1') person1Paid += bill.amount;
                else person2Paid += bill.amount;
            });
            
            currentSavings.forEach(saving => {
                if (saving.paidBy === 'person1') person1Paid += saving.amount;
                else person2Paid += saving.amount;
            });
            
            // Calculate balance
            const person1Balance = person1Paid - person1ShouldPay;
            const person2Balance = person2Paid - person2ShouldPay;
            
            return {
                totalIncome,
                totalBills,
                totalSavings,
                person1Balance,
                person2Balance,
                person1Percentage,
                person2Percentage
            };
        }

        // Update UI
        function updateUI() {
            const finances = calculateFinances();
            
            // Update dashboard
            document.getElementById('totalIncome').textContent = finances.totalIncome.toLocaleString('sv-SE') + ' kr';
            document.getElementById('totalBills').textContent = finances.totalBills.toLocaleString('sv-SE') + ' kr';
            document.getElementById('totalSavings').textContent = finances.totalSavings.toLocaleString('sv-SE') + ' kr';
            document.getElementById('remaining').textContent = (finances.totalIncome - finances.totalBills - finances.totalSavings).toLocaleString('sv-SE') + ' kr';
            
            // Update names
            document.getElementById('person1Name').textContent = appData.person1.name;
            document.getElementById('person2Name').textContent = appData.person2.name;
            document.getElementById('person1Share').textContent = finances.person1Balance.toLocaleString('sv-SE') + ' kr';
            document.getElementById('person2Share').textContent = finances.person2Balance.toLocaleString('sv-SE') + ' kr';
            
            // Update form values
            document.getElementById('person1NameInput').value = appData.person1.name;
            document.getElementById('person1Income').value = appData.person1.income;
            document.getElementById('person2NameInput').value = appData.person2.name;
            document.getElementById('person2Income').value = appData.person2.income;
            
            // Update select options
            document.getElementById('billPaidBy').innerHTML = `
                <option value="person1">${appData.person1.name}</option>
                <option value="person2">${appData.person2.name}</option>
            `;
            document.getElementById('savingPaidBy').innerHTML = `
                <option value="person1">${appData.person1.name}</option>
                <option value="person2">${appData.person2.name}</option>
            `;
            
            // Update lists
            updateBillsList();
            updateSavingsList();
        }

        // Update bills list
        function updateBillsList() {
            const currentBills = appData.bills.filter(bill => 
                bill.month === appData.currentMonth && bill.year === appData.currentYear
            );
            
            const billsList = document.getElementById('billsList');
            if (currentBills.length === 0) {
                billsList.innerHTML = '<p>Inga räkningar denna månad</p>';
                return;
            }
            
            billsList.innerHTML = currentBills.map(bill => `
                <div class="bill-item">
                    <div class="bill-details">
                        <div class="bill-name">${bill.name}</div>
                        <div class="bill-meta">Betald av: ${bill.paidBy === 'person1' ? appData.person1.name : appData.person2.name} • ${bill.date}</div>
                    </div>
                    <div class="bill-amount">
                        ${bill.amount.toLocaleString('sv-SE')} kr
                        <button class="delete-btn" onclick="deleteItem('bill', ${bill.id})">Ta bort</button>
                    </div>
                </div>
            `).join('');
        }

        // Update savings list
        function updateSavingsList() {
            const currentSavings = appData.savings.filter(saving => 
                saving.month === appData.currentMonth && saving.year === appData.currentYear
            );
            
            const savingsList = document.getElementById('savingsList');
            if (currentSavings.length === 0) {
                savingsList.innerHTML = '<p>Inget sparande/rörliga utgifter denna månad</p>';
                return;
            }
            
            savingsList.innerHTML = currentSavings.map(saving => `
                <div class="expense-item">
                    <div class="expense-details">
                        <div class="expense-name">${saving.name}</div>
                        <div class="expense-meta">
                            ${saving.type === 'equal' ? 'Jämn fördelning' : 'Enligt löneandel'} • 
                            Betald av: ${saving.paidBy === 'person1' ? appData.person1.name : appData.person2.name} • 
                            ${saving.date}
                        </div>
                    </div>
                    <div class="expense-amount">
                        ${saving.amount.toLocaleString('sv-SE')} kr
                        <button class="delete-btn" onclick="deleteItem('saving', ${saving.id})">Ta bort</button>
                    </div>
                </div>
            `).join('');
        }

        // Month navigation
        function changeMonth(direction) {
            appData.currentMonth += direction;
            if (appData.currentMonth > 11) {
                appData.currentMonth = 0;
                appData.currentYear++;
            } else if (appData.currentMonth < 0) {
                appData.currentMonth = 11;
                appData.currentYear--;
            }
            
            saveData();
            updateUI();
            updateMonthlyView();
        }

        // Update monthly view
        function updateMonthlyView() {
            const months = ['Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 
                          'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'];
            
            document.getElementById('currentMonth').textContent = 
                `${months[appData.currentMonth]} ${appData.currentYear}`;
            
            const monthBills = appData.bills.filter(bill => 
                bill.month === appData.currentMonth && bill.year === appData.currentYear
            );
            const monthSavings = appData.savings.filter(saving => 
                saving.month === appData.currentMonth && saving.year === appData.currentYear
            );
            
            const totalExpenses = [...monthBills, ...monthSavings].reduce((sum, item) => sum + item.amount, 0);
            const totalIncome = appData.person1.income + appData.person2.income;
            
            document.getElementById('monthlyIncome').textContent = totalIncome.toLocaleString('sv-SE') + ' kr';
            document.getElementById('monthlyExpenses').textContent = totalExpenses.toLocaleString('sv-SE') + ' kr';
            document.getElementById('monthlyResult').textContent = (totalIncome - totalExpenses).toLocaleString('sv-SE') + ' kr';
            
            // Update monthly details
            const details = document.getElementById('monthlyDetails');
            if (monthBills.length === 0 && monthSavings.length === 0) {
                details.innerHTML = '<p>Inga transaktioner denna månad</p>';
                return;
            }
            
            let detailsHTML = '';
            
            if (monthBills.length > 0) {
                detailsHTML += '<h4>Räkningar</h4>';
                monthBills.forEach(bill => {
                    detailsHTML += `
                        <div class="bill-item">
                            <div class="bill-details">
                                <div class="bill-name">${bill.name}</div>
                                <div class="bill-meta">Betald av: ${bill.paidBy === 'person1' ? appData.person1.name : appData.person2.name}</div>
                            </div>
                            <div class="bill-amount">${bill.amount.toLocaleString('sv-SE')} kr</div>
                        </div>
                    `;
                });
            }
            
            if (monthSavings.length > 0) {
                detailsHTML += '<h4 style="margin-top: 20px;">Sparande & Rörligt</h4>';
                monthSavings.forEach(saving => {
                    detailsHTML += `
                        <div class="expense-item">
                            <div class="expense-details">
                                <div class="expense-name">${saving.name}</div>
                                <div class="expense-meta">${saving.type === 'equal' ? 'Jämn fördelning' : 'Enligt löneandel'} • Betald av: ${saving.paidBy === 'person1' ? appData.person1.name : appData.person2.name}</div>
                            </div>
                            <div class="expense-amount">${saving.amount.toLocaleString('sv-SE')} kr</div>
                        </div>
                    `;
                });
            }
            
            details.innerHTML = detailsHTML;
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateMonthlyView();
        });
    </script>
</body>
</html>

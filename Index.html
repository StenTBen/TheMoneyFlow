<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemensam Ekonomi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #7f8c8d;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #ecf0f1;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #34495e;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: #667eea;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .summary-item h4 {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-item .amount {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .expense-item, .bill-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .expense-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .expense-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .expense-amount {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        .expense-details {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .month-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .month-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }

        .current-month {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .distribution-info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tab {
                padding: 12px 8px;
                font-size: 14px;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Gemensam Ekonomi</h1>
            <p>Hantera er ekonomi tillsammans</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="showTab('monthly')">M√•nadsvy</button>
            <button class="nav-tab" onclick="showTab('settings')">Inst√§llningar</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="summary-grid">
                <div class="summary-item">
                    <h4>Total Inkomst</h4>
                    <div class="amount" id="totalIncome">0 kr</div>
                </div>
                <div class="summary-item">
                    <h4>Totala R√§kningar</h4>
                    <div class="amount" id="totalBills">0 kr</div>
                </div>
                <div class="summary-item">
                    <h4>Totalt Sparande</h4>
                    <div class="amount" id="totalSavings">0 kr</div>
                </div>
                <div class="summary-item">
                    <h4>Kvar att F√∂rdela</h4>
                    <div class="amount" id="remaining">0 kr</div>
                </div>
            </div>

            <div class="card">
                <h3>Inkomstf√∂rdelning</h3>
                <div id="incomeDistribution"></div>
            </div>

            <div class="card">
                <h3>Senaste Aktiviteter</h3>
                <div id="recentActivities"></div>
            </div>
        </div>

        <!-- Monthly Tab -->
        <div id="monthly" class="tab-content">
            <div class="month-selector">
                <button class="month-btn" onclick="changeMonth(-1)">‚óÄ</button>
                <div class="current-month" id="currentMonth"></div>
                <button class="month-btn" onclick="changeMonth(1)">‚ñ∂</button>
            </div>

            <div class="card">
                <h3>L√§gg till R√§kning</h3>
                <div class="form-group">
                    <label>R√§kningsnamn</label>
                    <input type="text" id="billName" placeholder="t.ex. Hyra, El, Internet">
                </div>
                <div class="form-group">
                    <label>Belopp (kr)</label>
                    <input type="number" id="billAmount" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Vem betalade?</label>
                    <select id="billPayer">
                        <option value="person1" id="person1Option">Person 1</option>
                        <option value="person2" id="person2Option">Person 2</option>
                    </select>
                </div>
                <button class="btn" onclick="addBill()">L√§gg till R√§kning</button>
            </div>

            <div class="card">
                <h3>L√§gg till Sparande/R√∂rlig Utgift</h3>
                <div class="form-group">
                    <label>Namn</label>
                    <input type="text" id="savingName" placeholder="t.ex. Mat, Bensin, Sparande">
                </div>
                <div class="form-group">
                    <label>Belopp (kr)</label>
                    <input type="number" id="savingAmount" placeholder="0">
                </div>
                <div class="form-group">
                    <label>F√∂rdelning</label>
                    <select id="savingDistribution">
                        <option value="equal">J√§mn f√∂rdelning (50/50)</option>
                        <option value="proportional">Proportionell (% av l√∂n)</option>
                    </select>
                </div>
                <button class="btn" onclick="addSaving()">L√§gg till</button>
            </div>

            <div class="card">
                <h3>R√§kningar denna m√•nad</h3>
                <div id="monthlyBills"></div>
            </div>

            <div class="card">
                <h3>Sparande & R√∂rliga Utgifter</h3>
                <div id="monthlySavings"></div>
            </div>

            <div class="card">
                <h3>M√•nadssammanfattning</h3>
                <div id="monthlyBalance"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h3>Personinst√§llningar</h3>
                <div class="form-group">
                    <label>Person 1 - Namn</label>
                    <input type="text" id="person1Name" placeholder="Ditt namn">
                </div>
                <div class="form-group">
                    <label>Person 1 - Nettol√∂n (kr)</label>
                    <input type="number" id="person1Salary" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Person 2 - Namn</label>
                    <input type="text" id="person2Name" placeholder="Partnerns namn">
                </div>
                <div class="form-group">
                    <label>Person 2 - Nettol√∂n (kr)</label>
                    <input type="number" id="person2Salary" placeholder="0">
                </div>
                <button class="btn" onclick="saveSettings()">Spara Inst√§llningar</button>
            </div>

            <div class="card">
                <h3>Datahantering</h3>
                <button class="btn" onclick="exportData()">Exportera Data</button>
                <button class="btn btn-danger" onclick="clearAllData()">Rensa All Data</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let data = {
            settings: {
                person1: { name: 'Person 1', salary: 0 },
                person2: { name: 'Person 2', salary: 0 }
            },
            bills: {},
            savings: {}
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateDisplay();
            updateMonthDisplay();
        });

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Data management
        function saveData() {
            try {
                const dataStr = JSON.stringify(data);
                // Since we can't use localStorage, we'll keep data in memory for this session
                console.log('Data saved to memory');
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function loadData() {
            try {
                // In a real app, this would load from localStorage or a server
                console.log('Data loaded from memory');
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        // Settings
        function saveSettings() {
            const person1Name = document.getElementById('person1Name').value || 'Person 1';
            const person1Salary = parseFloat(document.getElementById('person1Salary').value) || 0;
            const person2Name = document.getElementById('person2Name').value || 'Person 2';
            const person2Salary = parseFloat(document.getElementById('person2Salary').value) || 0;

            data.settings.person1 = { name: person1Name, salary: person1Salary };
            data.settings.person2 = { name: person2Name, salary: person2Salary };

            // Update option labels
            document.getElementById('person1Option').textContent = person1Name;
            document.getElementById('person2Option').textContent = person2Name;

            saveData();
            updateDisplay();
            alert('Inst√§llningar sparade!');
        }

        // Month navigation
        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateMonthDisplay();
            updateDisplay();
        }

        function updateMonthDisplay() {
            const months = ['Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 
                          'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'];
            document.getElementById('currentMonth').textContent = `${months[currentMonth]} ${currentYear}`;
        }

        function getMonthKey() {
            return `${currentYear}-${currentMonth}`;
        }

        // Bills
        function addBill() {
            const name = document.getElementById('billName').value;
            const amount = parseFloat(document.getElementById('billAmount').value);
            const payer = document.getElementById('billPayer').value;

            if (!name || !amount) {
                alert('Fyll i alla f√§lt');
                return;
            }

            const monthKey = getMonthKey();
            if (!data.bills[monthKey]) {
                data.bills[monthKey] = [];
            }

            data.bills[monthKey].push({
                id: Date.now(),
                name: name,
                amount: amount,
                payer: payer,
                date: new Date().toISOString()
            });

            // Clear form
            document.getElementById('billName').value = '';
            document.getElementById('billAmount').value = '';

            saveData();
            updateDisplay();
        }

        // Savings
        function addSaving() {
            const name = document.getElementById('savingName').value;
            const amount = parseFloat(document.getElementById('savingAmount').value);
            const distribution = document.getElementById('savingDistribution').value;

            if (!name || !amount) {
                alert('Fyll i alla f√§lt');
                return;
            }

            const monthKey = getMonthKey();
            if (!data.savings[monthKey]) {
                data.savings[monthKey] = [];
            }

            data.savings[monthKey].push({
                id: Date.now(),
                name: name,
                amount: amount,
                distribution: distribution,
                date: new Date().toISOString()
            });

            // Clear form
            document.getElementById('savingName').value = '';
            document.getElementById('savingAmount').value = '';

            saveData();
            updateDisplay();
        }

        // Delete functions
        function deleteBill(id) {
            const monthKey = getMonthKey();
            if (data.bills[monthKey]) {
                data.bills[monthKey] = data.bills[monthKey].filter(bill => bill.id !== id);
                saveData();
                updateDisplay();
            }
        }

        function deleteSaving(id) {
            const monthKey = getMonthKey();
            if (data.savings[monthKey]) {
                data.savings[monthKey] = data.savings[monthKey].filter(saving => saving.id !== id);
                saveData();
                updateDisplay();
            }
        }

        // Calculations
        function calculateTotals() {
            const person1Salary = data.settings.person1.salary;
            const person2Salary = data.settings.person2.salary;
            const totalIncome = person1Salary + person2Salary;
            
            const person1Percentage = totalIncome > 0 ? person1Salary / totalIncome : 0.5;
            const person2Percentage = totalIncome > 0 ? person2Salary / totalIncome : 0.5;

            const monthKey = getMonthKey();
            const monthlyBills = data.bills[monthKey] || [];
            const monthlySavings = data.savings[monthKey] || [];

            const totalBills = monthlyBills.reduce((sum, bill) => sum + bill.amount, 0);
            const totalSavings = monthlySavings.reduce((sum, saving) => sum + saving.amount, 0);

            return {
                totalIncome,
                totalBills,
                totalSavings,
                person1Percentage,
                person2Percentage,
                person1Salary,
                person2Salary
            };
        }

        // Update display
        function updateDisplay() {
            const totals = calculateTotals();
            
            // Update dashboard
            document.getElementById('totalIncome').textContent = `${totals.totalIncome.toLocaleString()} kr`;
            document.getElementById('totalBills').textContent = `${totals.totalBills.toLocaleString()} kr`;
            document.getElementById('totalSavings').textContent = `${totals.totalSavings.toLocaleString()} kr`;
            document.getElementById('remaining').textContent = `${(totals.totalIncome - totals.totalBills - totals.totalSavings).toLocaleString()} kr`;

            // Update income distribution
            updateIncomeDistribution(totals);
            
            // Update monthly views
            updateMonthlyBills();
            updateMonthlySavings();
            updateMonthlyBalance(totals);
            
            // Update settings form
            updateSettingsForm();
        }

        function updateIncomeDistribution(totals) {
            const html = `
                <div class="distribution-info">
                    <p><strong>${data.settings.person1.name}:</strong> ${totals.person1Salary.toLocaleString()} kr (${(totals.person1Percentage * 100).toFixed(1)}%)</p>
                    <p><strong>${data.settings.person2.name}:</strong> ${totals.person2Salary.toLocaleString()} kr (${(totals.person2Percentage * 100).toFixed(1)}%)</p>
                </div>
            `;
            document.getElementById('incomeDistribution').innerHTML = html;
        }

        function updateMonthlyBills() {
            const monthKey = getMonthKey();
            const bills = data.bills[monthKey] || [];
            const totals = calculateTotals();
            
            let html = '';
            bills.forEach(bill => {
                const payerName = bill.payer === 'person1' ? data.settings.person1.name : data.settings.person2.name;
                const person1Share = bill.amount * totals.person1Percentage;
                const person2Share = bill.amount * totals.person2Percentage;
                
                html += `
                    <div class="bill-item">
                        <div class="expense-header">
                            <span class="expense-name">${bill.name}</span>
                            <span class="expense-amount">${bill.amount.toLocaleString()} kr</span>
                            <button class="delete-btn" onclick="deleteBill(${bill.id})">Ta bort</button>
                        </div>
                        <div class="expense-details">
                            Betald av: ${payerName}<br>
                            ${data.settings.person1.name} ska betala: ${person1Share.toLocaleString()} kr<br>
                            ${data.settings.person2.name} ska betala: ${person2Share.toLocaleString()} kr
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('monthlyBills').innerHTML = html || '<p>Inga r√§kningar √§nnu</p>';
        }

        function updateMonthlySavings() {
            const monthKey = getMonthKey();
            const savings = data.savings[monthKey] || [];
            const totals = calculateTotals();
            
            let html = '';
            savings.forEach(saving => {
                let person1Share, person2Share;
                
                if (saving.distribution === 'equal') {
                    person1Share = saving.amount / 2;
                    person2Share = saving.amount / 2;
                } else {
                    person1Share = saving.amount * totals.person1Percentage;
                    person2Share = saving.amount * totals.person2Percentage;
                }
                
                html += `
                    <div class="expense-item">
                        <div class="expense-header">
                            <span class="expense-name">${saving.name}</span>
                            <span class="expense-amount">${saving.amount.toLocaleString()} kr</span>
                            <button class="delete-btn" onclick="deleteSaving(${saving.id})">Ta bort</button>
                        </div>
                        <div class="expense-details">
                            F√∂rdelning: ${saving.distribution === 'equal' ? 'J√§mn (50/50)' : 'Proportionell'}<br>
                            ${data.settings.person1.name}: ${person1Share.toLocaleString()} kr<br>
                            ${data.settings.person2.name}: ${person2Share.toLocaleString()} kr
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('monthlySavings').innerHTML = html || '<p>Inga sparande/utgifter √§nnu</p>';
        }

        function updateMonthlyBalance(totals) {
            const monthKey = getMonthKey();
            const bills = data.bills[monthKey] || [];
            const savings = data.savings[monthKey] || [];
            
            let person1Owes = 0;
            let person2Owes = 0;
            let person1Paid = 0;
            let person2Paid = 0;
            
            // Calculate bills
            bills.forEach(bill => {
                const person1Share = bill.amount * totals.person1Percentage;
                const person2Share = bill.amount * totals.person2Percentage;
                
                person1Owes += person1Share;
                person2Owes += person2Share;
                
                if (bill.payer === 'person1') {
                    person1Paid += bill.amount;
                } else {
                    person2Paid += bill.amount;
                }
            });
            
            // Calculate savings
            savings.forEach(saving => {
                let person1Share, person2Share;
                
                if (saving.distribution === 'equal') {
                    person1Share = saving.amount / 2;
                    person2Share = saving.amount / 2;
                } else {
                    person1Share = saving.amount * totals.person1Percentage;
                    person2Share = saving.amount * totals.person2Percentage;
                }
                
                person1Owes += person1Share;
                person2Owes += person2Share;
            });
            
            const person1Balance = person1Paid - person1Owes;
            const person2Balance = person2Paid - person2Owes;
            
            let balanceText = '';
            if (person1Balance > person2Balance) {
                balanceText = `${data.settings.person2.name} √§r skyldig ${data.settings.person1.name} ${Math.abs(person1Balance - person2Balance).toLocaleString()} kr`;
            } else if (person2Balance > person1Balance) {
                balanceText = `${data.settings.person1.name} √§r skyldig ${data.settings.person2.name} ${Math.abs(person2Balance - person1Balance).toLocaleString()} kr`;
            } else {
                balanceText = 'Ni √§r kvitt!';
            }
            
            const html = `
                <div class="distribution-info">
                    <h4>M√•nadsbalans</h4>
                    <p><strong>${data.settings.person1.name}:</strong> Betalt ${person1Paid.toLocaleString()} kr, Ska betala ${person1Owes.toLocaleString()} kr</p>
                    <p><strong>${data.settings.person2.name}:</strong> Betalt ${person2Paid.toLocaleString()} kr, Ska betala ${person2Owes.toLocaleString()} kr</p>
                    <p style="font-size: 1.2rem; font-weight: bold; margin-top: 15px; color: #667eea;">${balanceText}</p>
                </div>
            `;
            
            document.getElementById('monthlyBalance').innerHTML = html;
        }

        function updateSettingsForm() {
            document.getElementById('person1Name').value = data.settings.person1.name;
            document.getElementById('person1Salary').value = data.settings.person1.salary;
            document.getElementById('person2Name').value = data.settings.person2.name;
            document.getElementById('person2Salary').value = data.settings.person2.salary;
            
            document.getElementById('person1Option').textContent = data.settings.person1.name;
            document.getElementById('person2Option').textContent = data.settings.person2.name;
        }

        // Data export/import
        function exportData() {
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ekonomi-data.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearAllData() {
            if (confirm('√Ñr du s√§ker p√• att du vill rensa all data? Detta kan inte √•ngras.')) {
                data = {
                    settings: {
                        person1: { name: 'Person 1', salary: 0 },
                        person2: { name: 'Person 2', salary: 0 }
                    },
                    bills: {},
                    savings: {}
                };
                saveData();
                updateDisplay();
                alert('All data har rensats!');
            }
        }
    </script>
</body>
</html>

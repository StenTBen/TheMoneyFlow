<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vår Ekonomi</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', system-ui, sans-serif;
}

:root {
    --primary: #3498db;
    --primary-dark: #2980b9;
    --secondary: #2ecc71;
    --danger: #e74c3c;
    --light-bg: #f8f9fa;
    --card-bg: #ffffff;
    --text: #2c3e50;
    --text-light: #7f8c8d;
    --border: #e0e7ff;
    --shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    --person1: #9b59b6;
    --person2: #1abc9c;
    --success: #27ae60;
    --warning: #f39c12;
}

body {
    background-color: var(--light-bg);
    color: var(--text);
    line-height: 1.6;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

header {
    text-align: center;
    margin-bottom: 30px;
    padding: 25px;
    background: var(--card-bg);
    border-radius: 16px;
    box-shadow: var(--shadow);
    position: relative;
}

header::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--person1), var(--person2));
}

h1 {
    font-size: 2.2rem;
    margin-bottom: 8px;
}

.subtitle {
    color: var(--text-light);
    font-size: 1.1rem;
}

.current-month-display {
    margin-top: 15px;
    font-weight: 500;
    color: var(--primary);
}

.sync-status {
    margin-top: 10px;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
}

.sync-status.connected {
    background: rgba(39, 174, 96, 0.1);
    color: var(--success);
}

.sync-status.disconnected {
    background: rgba(243, 156, 18, 0.1);
    color: var(--warning);
}

.nav-tabs {
    display: flex;
    background: var(--card-bg);
    border-radius: 12px;
    padding: 6px;
    margin-bottom: 25px;
    box-shadow: var(--shadow);
    position: sticky;
    top: 15px;
    z-index: 100;
}

.nav-tab {
    flex: 1;
    padding: 14px 10px;
    text-align: center;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s;
}

.nav-tab.active {
    background: var(--primary);
    color: white;
}

.tab-content {
    display: none;
    animation: fadein 0.4s ease;
}

@keyframes fadein {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.tab-content.active {
    display: block;
}

.card {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--primary);
}

.card h2 {
    margin-bottom: 20px;
    font-size: 1.4rem;
    color: var(--text);
}

.input-group {
    margin-bottom: 20px;
}

.input-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text);
}

.input-group input,
.input-group select {
    width: 100%;
    padding: 14px;
    border: 2px solid var(--border);
    border-radius: 10px;
    font-size: 16px;
    background: #f8fafc;
}

.input-group input:focus,
.input-group select:focus {
    outline: none;
    border-color: var(--primary);
}

.input-row {
    display: flex;
    gap: 15px;
}

.input-row .input-group {
    flex: 1;
}

.btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 14px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.2s;
    width: 100%;
    margin-top: 10px;
}

.btn:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
}

.btn:disabled {
    background: var(--text-light);
    cursor: not-allowed;
    transform: none;
}

.btn-outline {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
}

.btn-outline:hover {
    background: rgba(52, 152, 219, 0.1);
}

.btn-danger {
    background: var(--danger);
}

.btn-danger:hover {
    background: #c0392b;
}

.btn-success {
    background: var(--success);
}

.btn-success:hover {
    background: #229954;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
}

.summary-item {
    background: var(--card-bg);
    padding: 25px 20px;
    border-radius: 14px;
    text-align: center;
    box-shadow: var(--shadow);
}

.summary-item h3 {
    color: var(--text-light);
    font-size: 1rem;
    margin-bottom: 12px;
    font-weight: 500;
}

.summary-item .amount {
    font-size: 1.9rem;
    font-weight: bold;
}

.summary-item.positive .amount {
    color: var(--secondary);
}

.summary-item.negative .amount {
    color: var(--danger);
}

.person-balance {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: #f8fafc;
    border-radius: 12px;
    margin-bottom: 15px;
}

.person-name {
    font-weight: 600;
}

.person-amount {
    font-weight: bold;
    font-size: 1.2rem;
}

.person1 .person-name {
    color: var(--person1);
}

.person2 .person-name {
    color: var(--person2);
}

.item-list {
    max-height: 400px;
    overflow-y: auto;
    padding-right: 10px;
}

.list-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 0;
    border-bottom: 1px solid var(--border);
}

.item-details {
    flex: 1;
}

.item-name {
    font-weight: 600;
    margin-bottom: 5px;
}

.item-meta {
    font-size: 0.9rem;
    color: var(--text-light);
    display: flex;
    gap: 12px;
}

.item-amount {
    font-weight: bold;
    font-size: 1.1rem;
}

.paid-by {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
}

.paid-by-person1 {
    background: rgba(155, 89, 182, 0.15);
    color: var(--person1);
}

.paid-by-person2 {
    background: rgba(26, 188, 156, 0.15);
    color: var(--person2);
}

.delete-btn {
    background: rgba(231, 76, 60, 0.1);
    color: var(--danger);
    border: none;
    padding: 8px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    margin-left: 10px;
    transition: all 0.2s;
}

.delete-btn:hover {
    background: var(--danger);
    color: white;
}

.month-selector {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 25px;
    gap: 15px;
}

.month-nav {
    background: var(--primary);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
}

.month-nav:hover {
    background: var(--primary-dark);
}

.current-month {
    font-size: 1.3rem;
    font-weight: bold;
    color: var(--text);
    min-width: 200px;
    text-align: center;
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-light);
}

.empty-state p {
    margin-top: 10px;
}

.action-buttons {
    display: flex;
    gap: 15px;
    margin-top: 20px;
}

.sync-section {
    background: #f8fafc;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 15px;
}

.sync-id {
    font-family: 'Courier New', monospace;
    background: white;
    padding: 10px;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: bold;
    text-align: center;
    letter-spacing: 1px;
    margin: 10px 0;
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 10px;
    font-weight: 500;
    z-index: 1000;
    max-width: 300px;
    box-shadow: var(--shadow);
}

.notification.success {
    background: var(--success);
    color: white;
}

.notification.error {
    background: var(--danger);
    color: white;
}

.notification.warning {
    background: var(--warning);
    color: white;
}

.footer {
    text-align: center;
    padding: 20px;
    color: var(--text-light);
    font-size: 0.9rem;
    margin-top: 30px;
}

@media (max-width: 768px) {
    body {
        padding: 15px;
    }
    
    .summary-grid {
        grid-template-columns: 1fr;
    }
    
    .nav-tabs {
        flex-wrap: wrap;
    }
    
    .nav-tab {
        flex: 1 0 45%;
        margin: 5px;
        padding: 12px 8px;
        font-size: 14px;
    }
    
    .input-row {
        flex-direction: column;
        gap: 0;
    }
    
    .action-buttons {
        flex-direction: column;
        gap: 10px;
    }
    
    .notification {
        right: 10px;
        left: 10px;
        max-width: none;
    }
}
</style>
</head>
<body>
<header>
    <h1>Vår Ekonomi</h1>
    <p class="subtitle">Gemensam ekonomi för par med olika inkomster</p>
    <div class="current-month-display" id="currentMonthHeader">Juli 2025</div>
    <div class="sync-status" id="syncStatus">Synkronisering: Ej ansluten</div>
</header>

<div class="nav-tabs">
    <div class="nav-tab active" onclick="showTab('dashboard', event)">Översikt</div>
    <div class="nav-tab" onclick="showTab('sync', event)">Synkronisering</div>
    <div class="nav-tab" onclick="showTab('income', event)">Inkomster</div>
    <div class="nav-tab" onclick="showTab('bills', event)">Räkningar</div>
    <div class="nav-tab" onclick="showTab('savings', event)">Sparande & Rörligt</div>
    <div class="nav-tab" onclick="showTab('monthly', event)">Månadsvy</div>
</div>

<!-- Dashboard Tab -->
<div id="dashboard" class="tab-content active">
    <div class="summary-grid">
        <div class="summary-item">
            <h3>Total Nettoinkomst</h3>
            <div class="amount" id="totalIncome">0 kr</div>
        </div>
        <div class="summary-item">
            <h3>Totala Räkningar</h3>
            <div class="amount" id="totalBills">0 kr</div>
        </div>
        <div class="summary-item">
            <h3>Totalt Sparande & Rörligt</h3>
            <div class="amount" id="totalSavings">0 kr</div>
        </div>
        <div class="summary-item positive">
            <h3>Kvar Efter Allt</h3>
            <div class="amount" id="remaining">0 kr</div>
        </div>
    </div>
    <div class="card">
        <h2>Fördelning Denna Månad</h2>
        <div class="person-balance person1">
            <div class="person-name" id="person1NameDisplay">Du</div>
            <div class="person-amount" id="person1Balance">0 kr</div>
        </div>
        <div class="person-balance person2">
            <div class="person-name" id="person2NameDisplay">Partner</div>
            <div class="person-amount" id="person2Balance">0 kr</div>
        </div>
        <div class="summary-grid">
            <div class="summary-item">
                <h3 id="person1ShareLabel">Skuld/Tillgodo</h3>
                <div class="amount" id="person1Share">0 kr</div>
            </div>
            <div class="summary-item">
                <h3 id="person2ShareLabel">Skuld/Tillgodo</h3>
                <div class="amount" id="person2Share">0 kr</div>
            </div>
        </div>
    </div>
    <div class="action-buttons">
        <button class="btn btn-outline" onclick="exportData()">Exportera Data</button>
        <button class="btn btn-danger" onclick="resetData()">Nollställ Allt</button>
    </div>
</div>

<!-- Sync Tab -->
<div id="sync" class="tab-content">
    <div class="card">
        <h2>Delad Synkronisering</h2>
        <p>Dela era ekonomiska data så ni båda kan se samma information i realtid.</p>
        
        <div class="sync-section">
            <h3>Skapa Ny Delad Session</h3>
            <p>Generera en unik kod som din partner kan använda för att ansluta.</p>
            <button class="btn btn-success" onclick="createSyncSession()">Skapa Delad Session</button>
            <div id="syncIdDisplay" style="display: none;">
                <p><strong>Din synkroniseringskod:</strong></p>
                <div class="sync-id" id="syncId"></div>
                <p><small>Dela denna kod med din partner så de kan ansluta</small></p>
            </div>
        </div>
        
        <div class="sync-section">
            <h3>Anslut till Partner</h3>
            <p>Ange koden från din partner för att ansluta till er delade data.</p>
            <div class="input-group">
                <label for="partnerSyncId">Partner Synkroniseringskod:</label>
                <input type="text" id="partnerSyncId" placeholder="Ange 6-siffrig kod" maxlength="6" style="text-align: center; font-size: 1.2rem; letter-spacing: 2px;">
            </div>
            <button class="btn" onclick="connectToPartner()">Anslut till Partner</button>
        </div>
        
        <div class="sync-section">
            <h3>Synkroniseringsstatus</h3>
            <div id="syncStatusDetails">
                <p>Inte ansluten till delad session</p>
            </div>
            <button class="btn btn-danger" onclick="disconnectSync()" style="display: none;" id="disconnectBtn">Koppla från</button>
        </div>
    </div>
</div>

<!-- Income Tab -->
<div id="income" class="tab-content">
    <div class="card">
        <h2>Månadsinkomster</h2>
        <div class="input-row">
            <div class="input-group">
                <label for="person1NameInput">Person 1 Namn:</label>
                <input type="text" id="person1NameInput" placeholder="Ditt namn" value="Du">
            </div>
            <div class="input-group">
                <label for="person1Income">Nettolön (kr):</label>
                <input type="number" id="person1Income" placeholder="Nettolön" min="0">
            </div>
        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="person2NameInput">Person 2 Namn:</label>
                <input type="text" id="person2NameInput" placeholder="Din partners namn" value="Partner">
            </div>
            <div class="input-group">
                <label for="person2Income">Nettolön (kr):</label>
                <input type="number" id="person2Income" placeholder="Nettolön" min="0">
            </div>
        </div>
        <button class="btn" onclick="saveIncomes()">Spara Inkomster</button>
    </div>
</div>

<!-- Bills Tab -->
<div id="bills" class="tab-content">
    <div class="card">
        <h2>Lägg Till Räkning</h2>
        <div class="input-group">
            <label for="billName">Räkningens namn:</label>
            <input type="text" id="billName" placeholder="t.ex. Hyra, El, Internet">
        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="billAmount">Belopp (kr):</label>
                <input type="number" id="billAmount" placeholder="Belopp" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label for="billPaidBy">Vem betalade:</label>
                <select id="billPaidBy">
                    <option value="person1">Person 1</option>
                    <option value="person2">Person 2</option>
                </select>
            </div>
        </div>
        <button class="btn" onclick="addBill()">Lägg Till Räkning</button>
    </div>
    <div class="card">
        <h2>Räkningar Denna Månad</h2>
        <div class="item-list" id="billsList"></div>
    </div>
</div>

<!-- Savings Tab -->
<div id="savings" class="tab-content">
    <div class="card">
        <h2>Lägg Till Sparande/Rörlig Utgift</h2>
        <div class="input-group">
            <label for="savingName">Namn:</label>
            <input type="text" id="savingName" placeholder="t.ex. Mat, Bensin, Sparande">
        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="savingAmount">Belopp (kr):</label>
                <input type="number" id="savingAmount" placeholder="Belopp" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label for="savingType">Fördelning:</label>
                <select id="savingType">
                    <option value="equal">Jämn fördelning (50/50)</option>
                    <option value="percentage">Enligt löncandel (%)</option>
                </select>
            </div>
        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="savingPaidBy">Vem betalade:</label>
                <select id="savingPaidBy">
                    <option value="person1">Person 1</option>
                    <option value="person2">Person 2</option>
                </select>
            </div>
        </div>
        <button class="btn" onclick="addSaving()">Lägg Till</button>
    </div>
    <div class="card">
        <h2>Sparande & Rörliga Utgifter</h2>
        <div class="item-list" id="savingsList"></div>
    </div>
</div>

<!-- Monthly Tab -->
<div id="monthly" class="tab-content">
    <div class="month-selector">
        <button class="month-nav" onclick="changeMonth(-1)">&lt;</button>
        <div class="current-month" id="currentMonth"></div>
        <button class="month-nav" onclick="changeMonth(1)">&gt;</button>
    </div>
    <div class="summary-grid">
        <div class="summary-item">
            <h3>Månadens Inkomst</h3>
            <div class="amount" id="monthlyIncome">0 kr</div>
        </div>
        <div class="summary-item">
            <h3>Månadens Räkningar</h3>
            <div class="amount" id="monthlyBills">0 kr</div>
        </div>
        <div class="summary-item">
            <h3>Månadens Sparande</h3>
            <div class="amount" id="monthlySavings">0 kr</div>
        </div>
        <div class="summary-item positive">
            <h3>Månadens Resultat</h3>
            <div class="amount" id="monthlyResult">0 kr</div>
        </div>
    </div>
    <div class="card">
        <h2>Månadsdetaljer</h2>
        <div id="monthlyDetails"></div>
    </div>
</div>

<div class="footer">
    <p>Vår Ekonomi App &copy; 2025 | Data synkroniseras säkert mellan enheter</p>
</div>

<script>
// Global data storage
let appData = {
    person1: { name: 'Du', income: 0 },
    person2: { name: 'Partner', income: 0 },
    bills: [],
    savings: [],
    currentMonth: new Date().getMonth(),
    currentYear: new Date().getFullYear()
};

// Sync system
let syncSystem = {
    isConnected: false,
    sessionId: null,
    isHost: false,
    syncData: {},
    pollInterval: null
};

// Initialize app
function initApp() {
    // Generate unique session ID if not exists
    if (!localStorage.getItem('financeSessionId')) {
        localStorage.setItem('financeSessionId', generateSessionId());
    }

    // Load local data
    loadLocalData();

    // Check for existing sync session
    const savedSyncId = localStorage.getItem('syncSessionId');
    if (savedSyncId) {
        syncSystem.sessionId = savedSyncId;
        syncSystem.isConnected = true;
        startSyncPolling();
    }

    // Set current month header
    updateMonthHeader();

    // Update UI with loaded data
    updateUI();
    updateSyncStatus();
}

// Generate session ID
function generateSessionId() {
    return Math.random().toString(36).substr(2, 6).toUpperCase();
}

// Load data from localStorage
function loadLocalData() {
    const savedData = localStorage.getItem('coupleFinanceData');
    if (savedData) {
        try {
            const parsedData = JSON.parse(savedData);
            // Merge with defaults to ensure all properties exist
            appData = {
                ...appData,
                ...parsedData
            };
        } catch (e) {
            console.error("Fel vid laddning av data:", e);
            showNotification("Fel vid laddning av sparad data", "error");
        }
    }
}

// Save data to localStorage and sync
function saveData() {
    try {
        localStorage.setItem('coupleFinanceData', JSON.stringify(appData));

        // If connected to sync, update shared data
        if (syncSystem.isConnected && syncSystem.sessionId) {
            syncSystem.syncData[syncSystem.sessionId] = {
                ...appData,
                lastUpdated: Date.now(),
                updatedBy: localStorage.getItem('financeSessionId')
            };
            localStorage.setItem('syncData_' + syncSystem.sessionId,
                JSON.stringify(syncSystem.syncData[syncSystem.sessionId]));
        }
    } catch (e) {
        console.error("Fel vid sparande av data:", e);
        showNotification("Fel vid sparande av data", "error");
    }
}

// Show notification
function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Create sync session
function createSyncSession() {
    const sessionId = generateSessionId();
    syncSystem.sessionId = sessionId;
    syncSystem.isHost = true;
    syncSystem.isConnected = true;

    // Save sync session
    localStorage.setItem('syncSessionId', sessionId);

    // Initialize sync data
    syncSystem.syncData[sessionId] = {
        ...appData,
        lastUpdated: Date.now(),
        updatedBy: localStorage.getItem('financeSessionId')
    };

    localStorage.setItem('syncData_' + sessionId,
        JSON.stringify(syncSystem.syncData[sessionId]));

    // Show sync ID
    document.getElementById('syncId').textContent = sessionId;
    document.getElementById('syncIdDisplay').style.display = 'block';

    // Start polling
    startSyncPolling();

    updateSyncStatus();
    showNotification("Delad session skapad! Dela koden med din partner.", "success");
}

// Connect to partner
function connectToPartner() {
    const partnerId = document.getElementById('partnerSyncId').value.trim().toUpperCase();

    if (!partnerId || partnerId.length !== 6) {
        showNotification("Ange en giltig 6-siffrig kod", "error");
        return;
    }

    // Check if sync data exists
    const partnerData = localStorage.getItem('syncData_' + partnerId);
    if (!partnerData) {
        showNotification("Ingen data hittades för denna kod. Kontrollera att din partner har skapat sessionen.", "error");
        return;
    }

    try {
        const parsedData = JSON.parse(partnerData);

        // Merge partner data with local data
        appData = {
            ...appData,
            ...parsedData
        };

        syncSystem.sessionId = partnerId;
        syncSystem.isHost = false;
        syncSystem.isConnected = true;

        localStorage.setItem('syncSessionId', partnerId);
        saveData();

        startSyncPolling();
        updateUI();
        updateSyncStatus();

        showNotification("Ansluten till partners data!", "success");

        // Clear input
        document.getElementById('partnerSyncId').value = "";
    } catch (e) {
        console.error("Fel vid anslutning:", e);
        showNotification("Fel vid anslutning till partner", "error");
    }
}

// Start sync polling
function startSyncPolling() {
    if (syncSystem.pollInterval) {
        clearInterval(syncSystem.pollInterval);
    }

    syncSystem.pollInterval = setInterval(checkForUpdates, 2000);
}

// Check for updates from partner
function checkForUpdates() {
    if (!syncSystem.isConnected || !syncSystem.sessionId) return;

    const syncData = localStorage.getItem('syncData_' + syncSystem.sessionId);
    if (!syncData) return;

    try {
        const parsedData = JSON.parse(syncData);
        const mySessionId = localStorage.getItem('financeSessionId');

        // Check if data was updated by partner
        if (parsedData.updatedBy !== mySessionId && parsedData.lastUpdated > (appData.lastUpdated || 0)) {
            // Update local data with partner's changes
            appData = {
                ...parsedData
            };

            updateUI();
            showNotification("Data uppdaterad från partner", "success");
        }
    } catch (e) {
        console.error("Fel vid synkronisering:", e);
    }
}

// Disconnect sync
function disconnectSync() {
    if (confirm('Är du säker på att du vill koppla från den delade sessionen?')) {
        syncSystem.isConnected = false;
        syncSystem.sessionId = null;
        syncSystem.isHost = false;

        if (syncSystem.pollInterval) {
            clearInterval(syncSystem.pollInterval);
        }

        localStorage.removeItem('syncSessionId');

        updateSyncStatus();
        showNotification("Frånkopplad från delad session", "warning");

        // Hide sync display
        document.getElementById('syncIdDisplay').style.display = 'none';
    }
}

// Update sync status
function updateSyncStatus() {
    const statusElement = document.getElementById('syncStatus');
    const statusDetails = document.getElementById('syncStatusDetails');
    const disconnectBtn = document.getElementById('disconnectBtn');

    if (syncSystem.isConnected) {
        statusElement.textContent = `Synkronisering: Ansluten (${syncSystem.sessionId})`;
        statusElement.className = 'sync-status connected';

        statusDetails.innerHTML = `
            <p><strong>Status:</strong> Ansluten till delad session</p>
            <p><strong>Sessions-ID:</strong> ${syncSystem.sessionId}</p>
            <p><strong>Roll:</strong> ${syncSystem.isHost ? 'Värd' : 'Klient'}</p>
        `;
        disconnectBtn.style.display = 'block';
    } else {
        statusElement.textContent = 'Synkronisering: Ej ansluten';
        statusElement.className = 'sync-status disconnected';
        statusDetails.innerHTML = '<p>Inte ansluten till delad session</p>';
        disconnectBtn.style.display = 'none';
    }
}

// Show tab content
function showTab(tabId, event) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });

    // Remove active class from all tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
    });

    // Show selected tab
    document.getElementById(tabId).classList.add('active');
    
    // Add active class to clicked tab
    event.target.classList.add('active');
}

// Update month header
function updateMonthHeader() {
    const monthNames = ['Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 
                       'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'];
    const currentDate = new Date();
    const monthName = monthNames[currentDate.getMonth()];
    document.getElementById('currentMonthHeader').textContent = `${monthName} ${currentDate.getFullYear()}`;
    document.getElementById('currentMonth').textContent = `${monthName} ${currentDate.getFullYear()}`;
}

// Save incomes
function saveIncomes() {
    appData.person1.name = document.getElementById('person1NameInput').value;
    appData.person1.income = parseFloat(document.getElementById('person1Income').value) || 0;
    
    appData.person2.name = document.getElementById('person2NameInput').value;
    appData.person2.income = parseFloat(document.getElementById('person2Income').value) || 0;
    
    saveData();
    updateUI();
    showNotification("Inkomster sparade!");
}

// Add bill
function addBill() {
    const name = document.getElementById('billName').value.trim();
    const amount = parseFloat(document.getElementById('billAmount').value) || 0;
    const paidBy = document.getElementById('billPaidBy').value;
    
    if (!name) {
        showNotification("Ange ett namn för räkningen", "error");
        return;
    }
    
    if (amount <= 0) {
        showNotification("Ange ett giltigt belopp", "error");
        return;
    }
    
    appData.bills.push({
        id: Date.now(),
        name,
        amount,
        paidBy,
        date: new Date()
    });
    
    saveData();
    updateUI();
    showNotification("Räkning tillagd!");
    
    // Clear form
    document.getElementById('billName').value = '';
    document.getElementById('billAmount').value = '';
}

// Add saving
function addSaving() {
    const name = document.getElementById('savingName').value.trim();
    const amount = parseFloat(document.getElementById('savingAmount').value) || 0;
    const type = document.getElementById('savingType').value;
    const paidBy = document.getElementById('savingPaidBy').value;
    
    if (!name) {
        showNotification("Ange ett namn", "error");
        return;
    }
    
    if (amount <= 0) {
        showNotification("Ange ett giltigt belopp", "error");
        return;
    }
    
    appData.savings.push({
        id: Date.now(),
        name,
        amount,
        type,
        paidBy,
        date: new Date()
    });
    
    saveData();
    updateUI();
    showNotification("Sparande/rörlig utgift tillagd!");
    
    // Clear form
    document.getElementById('savingName').value = '';
    document.getElementById('savingAmount').value = '';
}

// Update UI
function updateUI() {
    // Update names
    document.getElementById('person1NameDisplay').textContent = appData.person1.name;
    document.getElementById('person2NameDisplay').textContent = appData.person2.name;
    
    // Calculate totals
    const totalIncome = appData.person1.income + appData.person2.income;
    const totalBills = appData.bills.reduce((sum, bill) => sum + bill.amount, 0);
    const totalSavings = appData.savings.reduce((sum, saving) => sum + saving.amount, 0);
    const remaining = totalIncome - totalBills - totalSavings;
    
    // Update dashboard
    document.getElementById('totalIncome').textContent = `${totalIncome.toFixed(2)} kr`;
    document.getElementById('totalBills').textContent = `${totalBills.toFixed(2)} kr`;
    document.getElementById('totalSavings').textContent = `${totalSavings.toFixed(2)} kr`;
    document.getElementById('remaining').textContent = `${remaining.toFixed(2)} kr`;
    
    // Update balances
    document.getElementById('person1Balance').textContent = `${appData.person1.income.toFixed(2)} kr`;
    document.getElementById('person2Balance').textContent = `${appData.person2.income.toFixed(2)} kr`;
    
    // Render bills list
    renderList('billsList', appData.bills, (bill) => {
        return `
            <div class="item-details">
                <div class="item-name">${bill.name}</div>
                <div class="item-meta">
                    <span>${bill.date.toLocaleDateString()}</span>
                    <span class="paid-by ${bill.paidBy === 'person1' ? 'paid-by-person1' : 'paid-by-person2'}">
                        ${bill.paidBy === 'person1' ? appData.person1.name : appData.person2.name}
                    </span>
                </div>
            </div>
            <div class="item-amount">${bill.amount.toFixed(2)} kr</div>
            <button class="delete-btn" onclick="deleteItem('bills', ${bill.id})">Ta bort</button>
        `;
    });
    
    // Render savings list
    renderList('savingsList', appData.savings, (saving) => {
        return `
            <div class="item-details">
                <div class="item-name">${saving.name}</div>
                <div class="item-meta">
                    <span>${saving.date.toLocaleDateString()}</span>
                    <span class="paid-by ${saving.paidBy === 'person1' ? 'paid-by-person1' : 'paid-by-person2'}">
                        ${saving.paidBy === 'person1' ? appData.person1.name : appData.person2.name}
                    </span>
                    <span>${saving.type === 'equal' ? '50/50' : 'Procent'}</span>
                </div>
            </div>
            <div class="item-amount">${saving.amount.toFixed(2)} kr</div>
            <button class="delete-btn" onclick="deleteItem('savings', ${saving.id})">Ta bort</button>
        `;
    });
}

// Render item list
function renderList(elementId, items, template) {
    const container = document.getElementById(elementId);
    container.innerHTML = '';
    
    if (items.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>Inga poster att visa</p></div>';
        return;
    }
    
    items.forEach(item => {
        const element = document.createElement('div');
        element.className = 'list-item';
        element.innerHTML = template(item);
        container.appendChild(element);
    });
}

// Delete item
function deleteItem(type, id) {
    if (confirm('Är du säker på att du vill ta bort denna post?')) {
        if (type === 'bills') {
            appData.bills = appData.bills.filter(bill => bill.id !== id);
        } else if (type === 'savings') {
            appData.savings = appData.savings.filter(saving => saving.id !== id);
        }
        
        saveData();
        updateUI();
        showNotification("Post borttagen!");
    }
}

// Change month
function changeMonth(direction) {
    appData.currentMonth += direction;
    
    if (appData.currentMonth < 0) {
        appData.currentMonth = 11;
        appData.currentYear--;
    } else if (appData.currentMonth > 11) {
        appData.currentMonth = 0;
        appData.currentYear++;
    }
    
    saveData();
    updateMonthView();
}

// Update month view
function updateMonthView() {
    const monthNames = ['Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 
                       'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'];
    document.getElementById('currentMonth').textContent = 
        `${monthNames[appData.currentMonth]} ${appData.currentYear}`;
    
    // Placeholder for month-specific calculations
    document.getElementById('monthlyIncome').textContent = '0 kr';
    document.getElementById('monthlyBills').textContent = '0 kr';
    document.getElementById('monthlySavings').textContent = '0 kr';
    document.getElementById('monthlyResult').textContent = '0 kr';
    document.getElementById('monthlyDetails').innerHTML = '<p>Funktionen är under utveckling</p>';
}

// Export data
function exportData() {
    const dataStr = JSON.stringify(appData);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    
    const exportFileDefaultName = 'ekonomi-data.json';
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
    showNotification("Data exporterad!");
}

// Reset data
function resetData() {
    if (confirm('Är du säker på att du vill nollställa all data? Detta går inte att ångra.')) {
        localStorage.removeItem('coupleFinanceData');
        appData = {
            person1: { name: 'Du', income: 0 },
            person2: { name: 'Partner', income: 0 },
            bills: [],
            savings: [],
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear()
        };
        updateUI();
        showNotification("All data har nollställts", "warning");
    }
}

// Initialize app when loaded
window.onload = function() {
    initApp();
    updateMonthView();
};
</script>
</body>
</html>

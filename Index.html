<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vår Ekonomi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #2c3e50;
            --text-light: #7f8c8d;
            --border: #e0e7ff;
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            --person1: #9b59b6;
            --person2: #1abc9c;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            position: relative;
        }
        
        header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--person1), var(--person2));
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        .current-month-display {
            margin-top: 15px;
            font-weight: 500;
            color: var(--primary);
        }
        
        .nav-tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 6px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 15px;
            z-index: 100;
        }
        
        .nav-tab {
            flex: 1;
            padding: 14px 10px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .nav-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }
        
        .card h2 {
            margin-bottom: 20px;
            font-size: 1.4rem;
            color: var(--text);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }
        
        .input-group input, 
        .input-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            background: #f8fafc;
        }
        
        .input-group input:focus, 
        .input-group select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .input-row {
            display: flex;
            gap: 15px;
        }
        
        .input-row .input-group {
            flex: 1;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: var(--primary-dark);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .summary-item {
            background: var(--card-bg);
            padding: 25px 20px;
            border-radius: 14px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .summary-item h3 {
            color: var(--text-light);
            font-size: 1rem;
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .summary-item .amount {
            font-size: 1.9rem;
            font-weight: bold;
        }
        
        .summary-item.positive .amount {
            color: var(--secondary);
        }
        
        .summary-item.negative .amount {
            color: var(--danger);
        }
        
        .person-balance {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .person-name {
            font-weight: 600;
        }
        
        .person-amount {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .person1 .person-name {
            color: var(--person1);
        }
        
        .person2 .person-name {
            color: var(--person2);
        }
        
        .item-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .item-meta {
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            gap: 12px;
        }
        
        .item-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .paid-by {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .paid-by-person1 {
            background: rgba(155, 89, 182, 0.15);
            color: var(--person1);
        }
        
        .paid-by-person2 {
            background: rgba(26, 188, 156, 0.15);
            color: var(--person2);
        }
        
        .delete-btn {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border: none;
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            transition: all 0.2s;
        }
        
        .delete-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        .month-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            gap: 15px;
        }
        
        .month-nav {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .month-nav:hover {
            background: var(--primary-dark);
        }
        
        .current-month {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--text);
            min-width: 200px;
            text-align: center;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }
        
        .empty-state p {
            margin-top: 10px;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tab {
                flex: 1 0 45%;
                margin: 5px;
                padding: 12px 8px;
                font-size: 14px;
            }
            
            .input-row {
                flex-direction: column;
                gap: 0;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Vår Ekonomi</h1>
        <p class="subtitle">Gemensam ekonomi för par med olika inkomster</p>
        <div class="current-month-display" id="currentMonthHeader">Juli 2025</div>
    </header>

    <div class="nav-tabs">
        <div class="nav-tab active" onclick="showTab('dashboard', event)">Översikt</div>
        <div class="nav-tab" onclick="showTab('income', event)">Inkomster</div>
        <div class="nav-tab" onclick="showTab('bills', event)">Räkningar</div>
        <div class="nav-tab" onclick="showTab('savings', event)">Sparande & Rörligt</div>
        <div class="nav-tab" onclick="showTab('monthly', event)">Månadsvy</div>
    </div>

    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content active">
        <div class="summary-grid">
            <div class="summary-item">
                <h3>Total Nettoinkomst</h3>
                <div class="amount" id="totalIncome">0 kr</div>
            </div>
            <div class="summary-item">
                <h3>Totala Räkningar</h3>
                <div class="amount" id="totalBills">0 kr</div>
            </div>
            <div class="summary-item">
                <h3>Totalt Sparande & Rörligt</h3>
                <div class="amount" id="totalSavings">0 kr</div>
            </div>
            <div class="summary-item positive">
                <h3>Kvar Efter Allt</h3>
                <div class="amount" id="remaining">0 kr</div>
            </div>
        </div>

        <div class="card">
            <h2>Fördelning Denna Månad</h2>
            
            <div class="person-balance person1">
                <div class="person-name" id="person1Name">Du</div>
                <div class="person-amount" id="person1Balance">0 kr</div>
            </div>
            
            <div class="person-balance person2">
                <div class="person-name" id="person2Name">Partner</div>
                <div class="person-amount" id="person2Balance">0 kr</div>
            </div>
            
            <div class="summary-grid">
                <div class="summary-item">
                    <h3 id="person1Name">Skuld/Tillgodo</h3>
                    <div class="amount" id="person1Share">0 kr</div>
                </div>
                <div class="summary-item">
                    <h3 id="person2Name">Skuld/Tillgodo</h3>
                    <div class="amount" id="person2Share">0 kr</div>
                </div>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="btn btn-outline" onclick="exportData()">Exportera Data</button>
            <button class="btn btn-danger" onclick="resetData()">Nollställ Allt</button>
        </div>
    </div>

    <!-- Income Tab -->
    <div id="income" class="tab-content">
        <div class="card">
            <h2>Månadsinkomster</h2>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="person1NameInput">Person 1 Namn:</label>
                    <input type="text" id="person1NameInput" placeholder="Ditt namn" value="Du">
                </div>
                
                <div class="input-group">
                    <label for="person1Income">Nettolön (kr):</label>
                    <input type="number" id="person1Income" placeholder="Nettolön" min="0">
                </div>
            </div>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="person2NameInput">Person 2 Namn:</label>
                    <input type="text" id="person2NameInput" placeholder="Din partners namn" value="Partner">
                </div>
                
                <div class="input-group">
                    <label for="person2Income">Nettolön (kr):</label>
                    <input type="number" id="person2Income" placeholder="Nettolön" min="0">
                </div>
            </div>
            
            <button class="btn" onclick="saveIncomes()">Spara Inkomster</button>
        </div>
    </div>

    <!-- Bills Tab -->
    <div id="bills" class="tab-content">
        <div class="card">
            <h2>Lägg Till Räkning</h2>
            
            <div class="input-group">
                <label for="billName">Räkningsnamn:</label>
                <input type="text" id="billName" placeholder="t.ex. Hyra, El, Internet">
            </div>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="billAmount">Belopp (kr):</label>
                    <input type="number" id="billAmount" placeholder="Belopp" min="0">
                </div>
                
                <div class="input-group">
                    <label for="billPaidBy">Vem betalade:</label>
                    <select id="billPaidBy">
                        <option value="person1">Person 1</option>
                        <option value="person2">Person 2</option>
                    </select>
                </div>
            </div>
            
            <button class="btn" onclick="addBill()">Lägg Till Räkning</button>
        </div>

        <div class="card">
            <h2>Räkningar Denna Månad</h2>
            <div class="item-list" id="billsList"></div>
        </div>
    </div>

    <!-- Savings Tab -->
    <div id="savings" class="tab-content">
        <div class="card">
            <h2>Lägg Till Sparande/Rörlig Utgift</h2>
            
            <div class="input-group">
                <label for="savingName">Namn:</label>
                <input type="text" id="savingName" placeholder="t.ex. Mat, Bensin, Sparande">
            </div>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="savingAmount">Belopp (kr):</label>
                    <input type="number" id="savingAmount" placeholder="Belopp" min="0">
                </div>
                
                <div class="input-group">
                    <label for="savingType">Fördelning:</label>
                    <select id="savingType">
                        <option value="equal">Jämn fördelning (50/50)</option>
                        <option value="percentage">Enligt löneandel (%)</option>
                    </select>
                </div>
            </div>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="savingPaidBy">Vem betalade:</label>
                    <select id="savingPaidBy">
                        <option value="person1">Person 1</option>
                        <option value="person2">Person 2</option>
                    </select>
                </div>
            </div>
            
            <button class="btn" onclick="addSaving()">Lägg Till</button>
        </div>

        <div class="card">
            <h2>Sparande & Rörliga Utgifter</h2>
            <div class="item-list" id="savingsList"></div>
        </div>
    </div>

    <!-- Monthly Tab -->
    <div id="monthly" class="tab-content">
        <div class="month-selector">
            <button class="month-nav" onclick="changeMonth(-1)">← Föregående</button>
            <div class="current-month" id="currentMonth"></div>
            <button class="month-nav" onclick="changeMonth(1)">Nästa →</button>
        </div>

        <div class="summary-grid">
            <div class="summary-item">
                <h3>Månadens Inkomst</h3>
                <div class="amount" id="monthlyIncome">0 kr</div>
            </div>
            <div class="summary-item">
                <h3>Månadens Räkningar</h3>
                <div class="amount" id="monthlyBills">0 kr</div>
            </div>
            <div class="summary-item">
                <h3>Månadens Sparande</h3>
                <div class="amount" id="monthlySavings">0 kr</div>
            </div>
            <div class="summary-item positive">
                <h3>Månadens Resultat</h3>
                <div class="amount" id="monthlyResult">0 kr</div>
            </div>
        </div>

        <div class="card">
            <h2>Månadsdetaljer</h2>
            <div id="monthlyDetails"></div>
        </div>
    </div>

    <div class="footer">
        <p>Vår Ekonomi App &copy; 2025 | Sparad data lagras endast på din enhet</p>
    </div>

    <script>
        // Global data storage
        let appData = {
            person1: { name: 'Du', income: 0 },
            person2: { name: 'Partner', income: 0 },
            bills: [],
            savings: [],
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear()
        };

        // Initialize app
        function initApp() {
            // Load data from localStorage
            const savedData = localStorage.getItem('coupleFinanceData');
            if (savedData) {
                appData = JSON.parse(savedData);
            }
            
            // Set current month header
            updateMonthHeader();
            
            // Update UI with loaded data
            updateUI();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('coupleFinanceData', JSON.stringify(appData));
        }

        // Tab navigation
        function showTab(tabName, event) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
            
            if (tabName === 'monthly') {
                updateMonthlyView();
            }
        }

        // Update month header
        function updateMonthHeader() {
            const months = ['Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 
                          'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'];
            const today = new Date();
            document.getElementById('currentMonthHeader').textContent = 
                `${months[today.getMonth()]} ${today.getFullYear()}`;
        }

        // Save incomes
        function saveIncomes() {
            const person1Name = document.getElementById('person1NameInput').value;
            const person1Income = parseFloat(document.getElementById('person1Income').value) || 0;
            const person2Name = document.getElementById('person2NameInput').value;
            const person2Income = parseFloat(document.getElementById('person2Income').value) || 0;
            
            // Update appData
            appData.person1.name = person1Name || 'Person 1';
            appData.person1.income = person1Income;
            appData.person2.name = person2Name || 'Person 2';
            appData.person2.income = person2Income;
            
            // Save to localStorage
            saveData();
            
            // Update UI
            updateUI();
            
            // Show confirmation
            alert('Inkomster sparade!');
        }

        // Add bill
        function addBill() {
            const name = document.getElementById('billName').value;
            const amount = parseFloat(document.getElementById('billAmount').value);
            const paidBy = document.getElementById('billPaidBy').value;
            
            if (!name || !amount) {
                alert('Fyll i namn och belopp');
                return;
            }
            
            const bill = {
                id: Date.now(),
                name,
                amount,
                paidBy,
                month: new Date().getMonth(),
                year: new Date().getFullYear(),
                date: new Date().toLocaleDateString('sv-SE')
            };
            
            appData.bills.push(bill);
            
            // Clear form
            document.getElementById('billName').value = '';
            document.getElementById('billAmount').value = '';
            
            saveData();
            updateUI();
        }

        // Add saving/variable expense
        function addSaving() {
            const name = document.getElementById('savingName').value;
            const amount = parseFloat(document.getElementById('savingAmount').value);
            const type = document.getElementById('savingType').value;
            const paidBy = document.getElementById('savingPaidBy').value;
            
            if (!name || !amount) {
                alert('Fyll i namn och belopp');
                return;
            }
            
            const saving = {
                id: Date.now(),
                name,
                amount,
                type,
                paidBy,
                month: new Date().getMonth(),
                year: new Date().getFullYear(),
                date: new Date().toLocaleDateString('sv-SE')
            };
            
            appData.savings.push(saving);
            
            // Clear form
            document.getElementById('savingName').value = '';
            document.getElementById('savingAmount').value = '';
            
            saveData();
            updateUI();
        }

        // Delete item
        function deleteItem(type, id) {
            if (confirm('Är du säker på att du vill ta bort detta?')) {
                if (type === 'bill') {
                    appData.bills = appData.bills.filter(bill => bill.id !== id);
                } else if (type === 'saving') {
                    appData.savings = appData.savings.filter(saving => saving.id !== id);
                }
                saveData();
                updateUI();
            }
        }

        // Calculate finances based on income percentage
        function calculateFinances() {
            const totalIncome = appData.person1.income + appData.person2.income;
            const person1Percentage = totalIncome > 0 ? appData.person1.income / totalIncome : 0.5;
            const person2Percentage = totalIncome > 0 ? appData.person2.income / totalIncome : 0.5;
            
            // Current month bills and savings
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            const currentBills = appData.bills.filter(bill => 
                bill.month === currentMonth && bill.year === currentYear
            );
            
            const currentSavings = appData.savings.filter(saving => 
                saving.month === currentMonth && saving.year === currentYear
            );
            
            const totalBills = currentBills.reduce((sum, bill) => sum + bill.amount, 0);
            const totalSavings = currentSavings.reduce((sum, saving) => sum + saving.amount, 0);
            
            // Calculate what each person should pay based on income percentage
            let person1ShouldPay = 0;
            let person2ShouldPay = 0;
            
            // Bills are split by income percentage
            person1ShouldPay += totalBills * person1Percentage;
            person2ShouldPay += totalBills * person2Percentage;
            
            // Savings depend on type
            currentSavings.forEach(saving => {
                if (saving.type === 'equal') {
                    person1ShouldPay += saving.amount / 2;
                    person2ShouldPay += saving.amount / 2;
                } else {
                    person1ShouldPay += saving.amount * person1Percentage;
                    person2ShouldPay += saving.amount * person2Percentage;
                }
            });
            
            // Calculate what each person has actually paid
            let person1Paid = 0;
            let person2Paid = 0;
            
            currentBills.forEach(bill => {
                if (bill.paidBy === 'person1') person1Paid += bill.amount;
                else person2Paid += bill.amount;
            });
            
            currentSavings.forEach(saving => {
                if (saving.paidBy === 'person1') person1Paid += saving.amount;
                else person2Paid += saving.amount;
            });
            
            // Calculate balance (what they should have paid vs what they actually paid)
            const person1Balance = person1Paid - person1ShouldPay;
            const person2Balance = person2Paid - person2ShouldPay;
            
            return {
                totalIncome,
                totalBills,
                totalSavings,
                person1Balance,
                person2Balance,
                person1Percentage,
                person2Percentage,
                person1Paid,
                person2Paid
            };
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('sv-SE', { 
                style: 'currency', 
                currency: 'SEK',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Update UI
        function updateUI() {
            const finances = calculateFinances();
            
            // Update dashboard
            document.getElementById('totalIncome').textContent = formatCurrency(finances.totalIncome);
            document.getElementById('totalBills').textContent = formatCurrency(finances.totalBills);
            document.getElementById('totalSavings').textContent = formatCurrency(finances.totalSavings);
            document.getElementById('remaining').textContent = formatCurrency(
                finances.totalIncome - finances.totalBills - finances.totalSavings
            );
            
            // Update names
            document.getElementById('person1Name').textContent = appData.person1.name;
            document.getElementById('person2Name').textContent = appData.person2.name;
            
            // Update balances
            document.getElementById('person1Balance').textContent = formatCurrency(finances.person1Paid);
            document.getElementById('person2Balance').textContent = formatCurrency(finances.person2Paid);
            document.getElementById('person1Share').textContent = formatCurrency(finances.person1Balance);
            document.getElementById('person2Share').textContent = formatCurrency(finances.person2Balance);
            
            // Update form values
            document.getElementById('person1NameInput').value = appData.person1.name;
            document.getElementById('person1Income').value = appData.person1.income;
            document.getElementById('person2NameInput').value = appData.person2.name;
            document.getElementById('person2Income').value = appData.person2.income;
            
            // Update select options
            document.getElementById('billPaidBy').innerHTML = `
                <option value="person1">${appData.person1.name}</option>
                <option value="person2">${appData.person2.name}</option>
            `;
            
            document.getElementById('savingPaidBy').innerHTML = `
                <option value="person1">${appData.person1.name}</option>
                <option value="person2">${appData.person2.name}</option>
            `;
            
            // Update lists
            updateBillsList();
            updateSavingsList();
        }

        // Update bills list
        function updateBillsList() {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            const currentBills = appData.bills.filter(bill => 
                bill.month === currentMonth && bill.year === currentYear
            );
            
            const billsList = document.getElementById('billsList');
            
            if (currentBills.length === 0) {
                billsList.innerHTML = '<div class="empty-state"><p>Inga räkningar denna månad</p></div>';
                return;
            }
            
            billsList.innerHTML = currentBills.map(bill => `
                <div class="list-item">
                    <div class="item-details">
                        <div class="item-name">${bill.name}</div>
                        <div class="item-meta">
                            <span>${bill.date}</span>
                            <span class="paid-by ${bill.paidBy === 'person1' ? 'paid-by-person1' : 'paid-by-person2'}">
                                ${bill.paidBy === 'person1' ? appData.person1.name : appData.person2.name}
                            </span>
                        </div>
                    </div>
                    <div class="item-amount">
                        ${formatCurrency(bill.amount)}
                        <button class="delete-btn" onclick="deleteItem('bill', ${bill.id})">Ta bort</button>
                    </div>
                </div>
            `).join('');
        }

        // Update savings list
        function updateSavingsList() {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            const currentSavings = appData.savings.filter(saving => 
                saving.month === currentMonth && saving.year === currentYear
            );
            
            const savingsList = document.getElementById('savingsList');
            
            if (currentSavings.length === 0) {
                savingsList.innerHTML = '<div class="empty-state"><p>Inga poster denna månad</p></div>';
                return;
            }
            
            savingsList.innerHTML = currentSavings.map(saving => `
                <div class="list-item">
                    <div class="item-details">
                        <div class="item-name">${saving.name}</div>
                        <div class="item-meta">
                            <span>${saving.date}</span>
                            <span>${saving.type === 'equal' ? '50/50' : 'Enligt lön'}</span>
                            <span class="paid-by ${saving.paidBy === 'person1' ? 'paid-by-person1' : 'paid-by-person2'}">
                                ${saving.paidBy === 'person1' ? appData.person1.name : appData.person2.name}
                            </span>
                        </div>
                    </div>
                    <div class="item-amount">
                        ${formatCurrency(saving.amount)}
                        <button class="delete-btn" onclick="deleteItem('saving', ${saving.id})">Ta bort</button>
                    </div>
                </div>
            `).join('');
        }

        // Month navigation
        function changeMonth(direction) {
            appData.currentMonth += direction;
            if (appData.currentMonth > 11) {
                appData.currentMonth = 0;
                appData.currentYear++;
            } else if (appData.currentMonth < 0) {
                appData.currentMonth = 11;
                appData.currentYear--;
            }
            
            saveData();
            updateMonthlyView();
        }

        // Update monthly view
        function updateMonthlyView() {
            const months = ['Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 
                          'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'];
            
            document.getElementById('currentMonth').textContent = 
                `${months[appData.currentMonth]} ${appData.currentYear}`;
            
            const monthBills = appData.bills.filter(bill => 
                bill.month === appData.currentMonth && bill.year === appData.currentYear
            );
            
            const monthSavings = appData.savings.filter(saving => 
                saving.month === appData.currentMonth && saving.year === appData.currentYear
            );
            
            const totalBills = monthBills.reduce((sum, bill) => sum + bill.amount, 0);
            const totalSavings = monthSavings.reduce((sum, saving) => sum + saving.amount, 0);
            const totalIncome = appData.person1.income + appData.person2.income;
            const totalResult = totalIncome - totalBills - totalSavings;
            
            document.getElementById('monthlyIncome').textContent = formatCurrency(totalIncome);
            document.getElementById('monthlyBills').textContent = formatCurrency(totalBills);
            document.getElementById('monthlySavings').textContent = formatCurrency(totalSavings);
            document.getElementById('monthlyResult').textContent = formatCurrency(totalResult);
            
            // Update monthly details
            const details = document.getElementById('monthlyDetails');
            
            let detailsHTML = '<h3>Räkningar</h3>';
            if (monthBills.length === 0) {
                detailsHTML += '<p>Inga räkningar denna månad</p>';
            } else {
                monthBills.forEach(bill => {
                    detailsHTML += `
                        <div class="list-item">
                            <div class="item-details">
                                <div class="item-name">${bill.name}</div>
                                <div class="item-meta">
                                    <span class="paid-by ${bill.paidBy === 'person1' ? 'paid-by-person1' : 'paid-by-person2'}">
                                        ${bill.paidBy === 'person1' ? appData.person1.name : appData.person2.name}
                                    </span>
                                </div>
                            </div>
                            <div class="item-amount">${formatCurrency(bill.amount)}</div>
                        </div>
                    `;
                });
            }
            
            detailsHTML += '<h3 style="margin-top: 25px;">Sparande & Rörliga Utgifter</h3>';
            if (monthSavings.length === 0) {
                detailsHTML += '<p>Inga poster denna månad</p>';
            } else {
                monthSavings.forEach(saving => {
                    detailsHTML += `
                        <div class="list-item">
                            <div class="item-details">
                                <div class="item-name">${saving.name}</div>
                                <div class="item-meta">
                                    <span>${saving.type === 'equal' ? '50/50' : 'Enligt lön'}</span>
                                    <span class="paid-by ${saving.paidBy === 'person1' ? 'paid-by-person1' : 'paid-by-person2'}">
                                        ${saving.paidBy === 'person1' ? appData.person1.name : appData.person2.name}
                                    </span>
                                </div>
                            </div>
                            <div class="item-amount">${formatCurrency(saving.amount)}</div>
                        </div>
                    `;
                });
            }
            
            details.innerHTML = detailsHTML;
        }

        // Export data as JSON
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `var-ekonomi-${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Reset all data
        function resetData() {
            if (confirm('Är du säker på att du vill nollställa ALL data? Detta går inte att ångra.')) {
                appData = {
                    person1: { name: 'Du', income: 0 },
                    person2: { name: 'Partner', income: 0 },
                    bills: [],
                    savings: [],
                    currentMonth: new Date().getMonth(),
                    currentYear: new Date().getFullYear()
                };
                localStorage.removeItem('coupleFinanceData');
                updateUI();
                alert('All data har nollställts!');
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
